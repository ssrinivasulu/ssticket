<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="MongoDB">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>About Toad - Mac Edition</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../Stylesheets/DSGStyles_DoNotEdit.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.current-topic-index-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapGlobal.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapDom.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapUtilities.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapXhr.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapTextEffects.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapSlideshow.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapFeedback.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapHelpSystem.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapTopic.js">
        </script>
    </head>
    <body>
        <div class="buttons inline-buttons clearfix topicToolbarProxy" style="mc-topic-toolbar-items: ;">
            <div class="button-group-container-left">
                <button class="button needs-pie previous-topic-button" type="button" title="Navigate previous">
                    <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                </button>
                <div class="button current-topic-index-button disabled"><span class="sequence-index"></span> of <span class="sequence-total"></span></div>
                <button class="button needs-pie next-topic-button" type="button" title="Navigate next">
                    <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                </button>
            </div>
        </div>
        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">You are here: </span><span class="MCBreadcrumbsSelf">MongoDB</span><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Using MapReduce operations</span>
        </div>
        <p>
            <img src="../gfx/toad-mac-64.png" style="float: left;" hspace="15px" />
        </p>
        <div style="margin-left: 100px;">
            <h3>Using MapReduce operations</h3>
            <h6>Process large volumes of data easily using custom JavaScript functions.</h6>
        </div>
        <p>MapReduce is a data-processing paradigm that allows you to process large volumes of data into aggregated results. <span class="DSGVariablesProductNameShort">Toadâ„¢ for Mac</span> now allows you to create your own MapReduce operations which use JavaScript Functions. This topic will illustrate this functionality using a practical example.</p>
        <p class="ScenarioHeading"><b>Scenario</b>
        </p>
        <p>We have a Collection that contains various US&#160;cities, their population and states in which the cities are located. We would like to get the average population for each state, meaning we have to sum all cities in a given state and then divide the number by the number of cities in a given state.<br /><br /><img src="../Images/MROps0.png" /></p>
        <ol>
            <li value="1">You are going to need two functions - <b>Map function</b> and <b>Reduce function</b>. Let's create the Map function first. <b>Right-click</b> the <b>Functions</b> node in your <b>Database</b> in <b>Object Explorer</b> and select <b>Create New JavaScript Function</b>.<br /><br /><img src="../Images/MROps1.png" /></li>
            <li value="2">Give the Map function a proper <b>Name</b> and then write the code that will emit a keys column and values column. In our case, the keys column in the <b>state</b> column and the values column is the <b>pop</b> column. <b>Finish</b> the wizard.<br /><br /><img src="../Images/MROps2.png" /></li>
            <li value="3">Now for the Reduce function. Again, choose an appropriate <b>Name</b> and then write the code that will return the desired aggregated values. In our case, we want to get the average of populations (values) in countries of states (keys). Once you're done, click on <b>Finish</b>.<br /><br /><img src="../Images/MROps3.png" /></li>
            <li value="4">Both newly created functions should be displayed under the <b>Functions</b> node in your <b>Database</b> in <b>Object Explorer</b>.<br /><br /><img src="../Images/MROps4.png" /></li>
            <li value="5">Open a new <b>Worksheet</b>. Make sure your Database is selected by running the <b>use *database name*</b> command.<br /><br /><img src="../Images/MROps5.png" /></li>
            <li value="6">Now you need to load the scripts you have created. This is done by running <b>db.loadServerScripts()</b> command.<br /><br /><img src="../Images/MROps6.png" /></li>
            <li value="7">Finally, run the <b>db.*collection*.mapReduce</b> method using your Map and Reduce function names as arguments. The result will be saved to a new Collection called "<b>state_average_population</b>".<br /><br /><img src="../Images/MROps7.png" /></li>
            <li value="8">Open the  "<b>state_average_population</b>" Collection and you will see the results. The numbers represent the <b>average populations</b> of each <b>state</b> listed in the source Collection.<br /><br /><img src="../Images/MROps8.png" /></li>
        </ol>
        <p>&#160;</p>
        <p>&#160;</p>
    </body>
</html>